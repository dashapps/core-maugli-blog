---
import { getCollection, render, type CollectionEntry } from 'astro:content';
import HeroImage from '../components/HeroImage.astro';
import { maugliConfig } from '../config/maugli.config';
import { LANGUAGES } from '../i18n/languages';
import BaseLayout from '../layouts/BaseLayout.astro';

export async function getStaticPaths() {
    const pages = await getCollection('pages');

    return pages.map((page) => {
        return {
            params: { id: page.id },
            props: { page }
        };
    });
}

type Props = { page: CollectionEntry<'pages'> };

const { page } = Astro.props;

const { title, seo } = page.data;
const { Content } = await render(page);

const dicts: Record<string, any> = Object.fromEntries(LANGUAGES.map((l) => [l.code, l.dict]));
const lang: string = typeof maugliConfig.defaultLang === 'string' && dicts[maugliConfig.defaultLang] ? maugliConfig.defaultLang : 'en';
const dict = dicts[lang] || dicts['en'];

const pageTitle = seo?.title ?? title ?? dict.pages?.defaultTitle ?? dicts['en'].pages?.defaultTitle ?? 'Page';
const pageDesc = seo?.description ?? dict.pages?.defaultDescription ?? dicts['en'].pages?.defaultDescription ?? '';
---

<BaseLayout title={pageTitle} description={pageDesc} image={seo?.image} showHeader={false} fullWidth={true}>
    <article class="mb-16 sm:mb-24">
        <HeroImage
            src={page.data.seo?.image?.src || '/default.webp'}
            alt={page.data.seo?.image?.alt || page.data.title || 'Без названия'}
            caption={page.data.seo?.image?.caption}
            width={page.data.seo?.image?.width || 1200}
            height={page.data.seo?.image?.height || 630}
            srcset={page.data.seo?.image?.srcset}
            sizes="(max-width: 640px) 100vw, (max-width: 1200px) 80vw, 1200px"
        />
        <header class="mb-8">
            <h1 class="text-3xl leading-tight font-serif font-[800] sm:text-5xl sm:leading-tight" style="color: var(--text-heading)">{title}</h1>
        </header>
        <div class="max-w-none prose sm:prose-lg">
            <Content />
        </div>
    </article>
</BaseLayout>
