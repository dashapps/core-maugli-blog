---
import { maugliConfig } from '../config/maugli.config';
import { LANGUAGES } from '../i18n/languages';
import Button from './Button.astro';
// Универсальный импорт словарей по доступным языкам
const dicts: Record<string, any> = {};
for (const lang of LANGUAGES) {
    try {
        dicts[lang.code] = await import(`../i18n/${lang.code}.json`).then((m) => m.default);
    } catch {}
}

const subscribe = maugliConfig.subscribe;
const { class: className } = Astro.props;
const lang: string = maugliConfig.defaultLang;
const dict = dicts[lang] || dicts['en'] || {};

const heading = subscribe.heading || dict.subscribe?.heading || dicts['en']?.subscribe?.heading;
const mutedText = subscribe.mutedText || dict.subscribe?.mutedText || dicts['en']?.subscribe?.mutedText;
---

{
    subscribe?.formUrl && (
        <div class:list={['max-w-[1280px] mx-auto', className]}>
            <section class="px-8 py-12 flex flex-col items-center border border-solid border-main text-center rounded-custom sm:px-12 sm:py-16 my-16 sm:my-24">
                {heading && (
                    <h2 style="color:var(--text-heading)" class="w-full text-2xl leading-tight font-serif font-black sm:text-4xl mb-4">
                        {heading}
                    </h2>
                )}
                {mutedText && (
                    <p style="color:var(--text-muted)" class="w-full max-w-xl mb-8 text-sm leading-normal md:text-base">
                        {mutedText}
                    </p>
                )}
                <form
                    action={subscribe.formUrl}
                    method="post"
                    id="subscribe-form"
                    name="subscribe-form"
                    aria-label={dict.form?.subscribeAriaLabel || en.form.subscribeAriaLabel}
                    class="w-full max-w-xl flex flex-col gap-3.5 sm:flex-row"
                    target="_blank"
                >
                    <label for="email" class="sr-only">
                        {dict.form?.emailLabel || en.form.emailLabel}
                    </label>
                    <input
                        type="email"
                        name="email"
                        id="email"
                        class="flex-1 h-11 px-5 py-2 text-sm border border-solid border-main rounded-custom placeholder:opacity-50 focus:outline-none focus:ring-2 focus:ring-brand focus:border-transparent"
                        required=""
                        value=""
                        placeholder={dict.form?.emailPlaceholder || en.form.emailPlaceholder}
                    />
                    <Button
                        type="submit"
                        name="subscribe"
                        class="w-full h-11 sm:w-auto !text-[var(--bg-main)] !bg-[var(--brand-color)] !border-[var(--brand-color)] !not-italic"
                    >
                        {dict.buttons?.subscribe || en.buttons.subscribe}
                    </Button>
                </form>
            </section>
        </div>
    )
}
